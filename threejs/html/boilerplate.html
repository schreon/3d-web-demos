<!DOCTYPE html><html><head><title>.: spring physics :.</title>
<style>
body { background: #000; color: #aaa;}
</style>
</head>
<body>
  <!-- TODO -->
<!-- scripts -->
<script type="text/javascript" src="../js/physicscontroller.js"></script>
<script type="text/javascript" src="../js/three.min.js"></script>
<!-- custom script -->
<script type="text/javascript">
  // Array Remove - By John Resig (MIT Licensed)
  Array.prototype.remove = function(from, to) {
    var rest = this.slice((to || from) + 1 || this.length);
    this.length = from < 0 ? this.length + from : from;
    return this.push.apply(this, rest);
  };

  /* ****************** */
  /* SIMULATION STATE   */
  var numBodies;
  var running = true;

  var spController = PhysicsController.create("../js/");
  /* ****************** */

  /* ****************** */
  /* VIEW ELEMENTS   */
  var bodies=[], linesVel=[], linesAcc=[];
  var camera, scene, renderer;
  /* ****************** */

  function init() {
    var w = window.innerWidth / 2;
    var h = window.innerHeight / 2;
    camera = new THREE.OrthographicCamera(-w, w, -h, h, 1, 10000 );
    camera.position.set(0, 0, 100);
    camera.lookAt(new THREE.Vector3(0, 0, 0));

    scene = new THREE.Scene();

    /* **************************** */

    // Center circle
      var material = new THREE.LineBasicMaterial({
          color: 0xFF0000,
      });
        var geometry = new THREE.CircleGeometry(1,20);
      var circle = new THREE.Line(geometry, material);
      circle.position.x=-1;
      circle.position.y=-1;
      circle.position.z=0;
      scene.add(circle);


    // bottom line
    var material = new THREE.LineBasicMaterial({
          color: 0xFF0000,
    });
    var geometry = new THREE.Geometry();
    geometry.vertices.push(new THREE.Vector3(-400, -200, 0));
    geometry.vertices.push(new THREE.Vector3(-400, 200, 0));
    geometry.vertices.push(new THREE.Vector3(400, 200, 0));
    geometry.vertices.push(new THREE.Vector3(400, -200, 0));
    geometry.vertices.push(new THREE.Vector3(-400, -200, 0));
    var bottomLine = new THREE.Line(geometry, material);
    scene.add(bottomLine);


    /* **************************** */
    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize( window.innerWidth, window.innerHeight );

    document.body.appendChild( renderer.domElement );
  }

  /* ******** */
  spController.onInitFinished = function(posX, posY, anglesX, anglesY,radii,debugInfo){
    numBodies = posX.length;

    init(); // Trigger view init

    /* ADD VIEW ELEMENTS */
    var material = new THREE.LineBasicMaterial({
        color: 0xFFFF00
    });
    for (var i=0; i < numBodies; i++){
      var geometry = new THREE.CircleGeometry(radii[i],20);
      var circle = new THREE.Line(geometry, material);
      circle.position.x=posX[i];
      circle.position.y=posY[i];
      circle.position.z=0;
      scene.add(circle);
      bodies.push(circle);
    }

    console.log("onInitFinished");

    renderer.render( scene, camera );
    spController.doUpdate(); // Trigger first update
  };

  spController.onUpdate = function(posX, posY, anglesX, anglesY,radii,debugInfo){

    /* SCENE UPDATES */
    if(running) spController.doUpdate(); // trigger next update

    /* SIMULATION STATE UPDATES */

    /* VIEW UPDATES */
    for(var i=0; i < numBodies; i++) {
      bodies[i].position.x = posX[i];
      bodies[i].position.y = posY[i];
    }

    renderer.render( scene, camera );
  };

  spController.init();
  </script>
</body>
</html>
